# üìã CONTEXT.md - Documentation Technique du Projet

> Ce fichier sert de r√©f√©rence centrale pour comprendre l'architecture, la structure de la base de donn√©es, et les d√©cisions techniques du projet FollowSport.

---

## üóÑÔ∏è Structure de la base de donn√©es

### Base de donn√©es : `followSport_app`

---

### üìä Table : `users`

**Description** : Stocke les informations des utilisateurs de l'application.

| Colonne | Type | Contraintes | Description |
|---------|------|-------------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT | Identifiant unique |
| `first_name` | VARCHAR(100) | NOT NULL | Pr√©nom |
| `last_name` | VARCHAR(100) | NOT NULL | Nom de famille |
| `email` | VARCHAR(255) | NOT NULL, UNIQUE | Email (login) |
| `password` | VARCHAR(255) | NOT NULL | Mot de passe (‚ö†Ô∏è √† hasher avec bcrypt) |
| `birthdate` | DATE | NULL | Date de naissance |
| `gender` | ENUM | NULL | Sexe : 'male', 'female', 'other' |
| `fitness_level` | ENUM | NULL | Niveau : 'beginner', 'intermediate', 'advanced' |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Date de cr√©ation |
| `updated_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | Date de mise √† jour |

**Index** :
- PRIMARY KEY sur `id`
- UNIQUE sur `email`

**Statut** : ‚úÖ Impl√©ment√© dans le backend (CRUD complet)

---

### üìä Table : `programs` (√† impl√©menter)

**Description** : Programmes d'entra√Ænement disponibles.

| Colonne | Type | Contraintes | Description |
|---------|------|-------------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT | Identifiant unique |
| `name` | VARCHAR(255) | NOT NULL | Nom du programme |
| `description` | TEXT | NULL | Description d√©taill√©e |
| `difficulty_level` | ENUM | NULL | Difficult√© : 'beginner', 'intermediate', 'advanced' |
| `duration_weeks` | INT | NULL | Dur√©e en semaines |
| `goal` | VARCHAR(255) | NULL | Objectif (perte de poids, prise de masse, etc.) |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Date de cr√©ation |
| `updated_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE | Date de mise √† jour |

**Statut** : ‚è≥ √Ä impl√©menter

---

### üìä Table : `user_programs` (√† impl√©menter)

**Description** : Relation N:N entre utilisateurs et programmes (programmes assign√©s/suivis).

| Colonne | Type | Contraintes | Description |
|---------|------|-------------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT | Identifiant unique |
| `user_id` | INT | FOREIGN KEY ‚Üí users(id) | R√©f√©rence utilisateur |
| `program_id` | INT | FOREIGN KEY ‚Üí programs(id) | R√©f√©rence programme |
| `start_date` | DATE | NOT NULL | Date de d√©but |
| `end_date` | DATE | NULL | Date de fin (si termin√©) |
| `status` | ENUM | DEFAULT 'active' | Statut : 'active', 'completed', 'paused' |
| `progress` | INT | DEFAULT 0 | Progression en % (0-100) |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Date d'assignation |

**Relations** :
- `user_id` ‚Üí `users.id` (CASCADE on DELETE)
- `program_id` ‚Üí `programs.id` (CASCADE on DELETE)

**Statut** : ‚è≥ √Ä impl√©menter

---

### üìä Table : `sessions` (√† impl√©menter)

**Description** : Sessions d'entra√Ænement li√©es √† un programme.

| Colonne | Type | Contraintes | Description |
|---------|------|-------------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT | Identifiant unique |
| `program_id` | INT | FOREIGN KEY ‚Üí programs(id) | R√©f√©rence programme |
| `session_number` | INT | NOT NULL | Num√©ro de la session (ordre) |
| `name` | VARCHAR(255) | NOT NULL | Nom de la session |
| `description` | TEXT | NULL | Description |
| `duration_minutes` | INT | NULL | Dur√©e estim√©e en minutes |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Date de cr√©ation |

**Relations** :
- `program_id` ‚Üí `programs.id` (CASCADE on DELETE)

**Statut** : ‚è≥ √Ä impl√©menter

---

### üìä Table : `exercises` (√† impl√©menter)

**Description** : Biblioth√®que d'exercices disponibles.

| Colonne | Type | Contraintes | Description |
|---------|------|-------------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT | Identifiant unique |
| `name` | VARCHAR(255) | NOT NULL | Nom de l'exercice |
| `description` | TEXT | NULL | Description d√©taill√©e |
| `category` | VARCHAR(100) | NULL | Cat√©gorie (cardio, strength, flexibility, etc.) |
| `difficulty` | ENUM | NULL | Difficult√© : 'beginner', 'intermediate', 'advanced' |
| `video_url` | VARCHAR(500) | NULL | URL de la vid√©o de d√©monstration |
| `image_url` | VARCHAR(500) | NULL | URL de l'image |
| `instructions` | TEXT | NULL | Instructions d√©taill√©es |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Date de cr√©ation |

**Statut** : ‚è≥ √Ä impl√©menter

---

### üìä Table : `session_exercises` (√† impl√©menter)

**Description** : Relation N:N entre sessions et exercices (exercices dans une session).

| Colonne | Type | Contraintes | Description |
|---------|------|-------------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT | Identifiant unique |
| `session_id` | INT | FOREIGN KEY ‚Üí sessions(id) | R√©f√©rence session |
| `exercise_id` | INT | FOREIGN KEY ‚Üí exercises(id) | R√©f√©rence exercice |
| `order_index` | INT | NOT NULL | Ordre dans la session |
| `sets` | INT | NULL | Nombre de s√©ries |
| `reps` | INT | NULL | Nombre de r√©p√©titions |
| `duration_seconds` | INT | NULL | Dur√©e en secondes (pour cardio) |
| `rest_seconds` | INT | NULL | Temps de repos entre s√©ries |
| `notes` | TEXT | NULL | Notes sp√©cifiques |

**Relations** :
- `session_id` ‚Üí `sessions.id` (CASCADE on DELETE)
- `exercise_id` ‚Üí `exercises.id` (CASCADE on DELETE)

**Statut** : ‚è≥ √Ä impl√©menter

---

### üìä Table : `user_session_logs` (√† impl√©menter - optionnel)

**Description** : Historique des sessions effectu√©es par les utilisateurs.

| Colonne | Type | Contraintes | Description |
|---------|------|-------------|-------------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT | Identifiant unique |
| `user_id` | INT | FOREIGN KEY ‚Üí users(id) | R√©f√©rence utilisateur |
| `session_id` | INT | FOREIGN KEY ‚Üí sessions(id) | R√©f√©rence session |
| `completed_at` | TIMESTAMP | NOT NULL | Date de compl√©tion |
| `duration_minutes` | INT | NULL | Dur√©e r√©elle |
| `notes` | TEXT | NULL | Notes de l'utilisateur |
| `rating` | INT | NULL | Note de 1 √† 5 |

**Relations** :
- `user_id` ‚Üí `users.id` (CASCADE on DELETE)
- `session_id` ‚Üí `sessions.id` (CASCADE on DELETE)

**Statut** : ‚è≥ √Ä impl√©menter

---

## üèóÔ∏è Architecture Backend

### Structure des dossiers

```
backend-followsport/
‚îú‚îÄ‚îÄ index.js                    # Point d'entr√©e + config Express
‚îú‚îÄ‚îÄ db.js                       # Configuration MySQL (pool de connexions)
‚îú‚îÄ‚îÄ .env                        # Variables d'environnement (ignor√© par git)
‚îú‚îÄ‚îÄ .env.example                # Template des variables
‚îú‚îÄ‚îÄ package.json                # D√©pendances npm
‚îú‚îÄ‚îÄ .gitignore                  # Fichiers ignor√©s par git
‚îÇ
‚îú‚îÄ‚îÄ routes/                     # D√©finition des routes Express
‚îÇ   ‚îú‚îÄ‚îÄ users.js                ‚úÖ Impl√©ment√©
‚îÇ   ‚îú‚îÄ‚îÄ programs.js             ‚è≥ √Ä cr√©er
‚îÇ   ‚îú‚îÄ‚îÄ sessions.js             ‚è≥ √Ä cr√©er
‚îÇ   ‚îú‚îÄ‚îÄ exercises.js            ‚è≥ √Ä cr√©er
‚îÇ   ‚îî‚îÄ‚îÄ userPrograms.js         ‚è≥ √Ä cr√©er
‚îÇ
‚îú‚îÄ‚îÄ controllers/                # Logique m√©tier + validation
‚îÇ   ‚îú‚îÄ‚îÄ usersController.js      ‚úÖ Impl√©ment√©
‚îÇ   ‚îú‚îÄ‚îÄ programsController.js   ‚è≥ √Ä cr√©er
‚îÇ   ‚îú‚îÄ‚îÄ sessionsController.js   ‚è≥ √Ä cr√©er
‚îÇ   ‚îú‚îÄ‚îÄ exercisesController.js  ‚è≥ √Ä cr√©er
‚îÇ   ‚îî‚îÄ‚îÄ userProgramsController.js ‚è≥ √Ä cr√©er
‚îÇ
‚îú‚îÄ‚îÄ models/                     # Requ√™tes SQL (CRUD)
‚îÇ   ‚îú‚îÄ‚îÄ usersModel.js           ‚úÖ Impl√©ment√©
‚îÇ   ‚îú‚îÄ‚îÄ programsModel.js        ‚è≥ √Ä cr√©er
‚îÇ   ‚îú‚îÄ‚îÄ sessionsModel.js        ‚è≥ √Ä cr√©er
‚îÇ   ‚îú‚îÄ‚îÄ exercisesModel.js       ‚è≥ √Ä cr√©er
‚îÇ   ‚îî‚îÄ‚îÄ userProgramsModel.js    ‚è≥ √Ä cr√©er
‚îÇ
‚îî‚îÄ‚îÄ docs/                       # Documentation
    ‚îú‚îÄ‚îÄ endpoints.md            ‚úÖ Documentation API
    ‚îî‚îÄ‚îÄ database-schema.sql     ‚è≥ √Ä cr√©er (export SQL des tables)
```

---

## üîß Stack Technique

| Technologie | Version | Usage |
|-------------|---------|-------|
| **Node.js** | v16+ | Runtime JavaScript |
| **Express** | ^5.1.0 | Framework web |
| **MySQL** | v8+ | Base de donn√©es relationnelle |
| **mysql2** | ^3.15.2 | Driver MySQL avec async/await |
| **dotenv** | ^17.2.3 | Variables d'environnement |
| **cors** | ^2.8.5 | Gestion CORS |
| **nodemon** | ^3.1.10 | Auto-reload en dev |

---

## üìê Conventions de code

### Naming Conventions

- **Fichiers** : camelCase (ex: `usersController.js`)
- **Variables/Fonctions** : camelCase (ex: `getUserById`)
- **Constantes** : UPPER_SNAKE_CASE (ex: `DB_HOST`)
- **Classes** : PascalCase (si n√©cessaire)
- **Tables DB** : snake_case (ex: `user_programs`)

### Structure des r√©ponses API

**Succ√®s**
```javascript
{
  success: true,
  message: "Message descriptif",
  data: { /* ... */ },
  count: 10  // Pour les listes
}
```

**Erreur**
```javascript
{
  success: false,
  message: "Description de l'erreur",
  error: "D√©tails techniques (en dev seulement)"
}
```

### Codes HTTP utilis√©s

- `200` : OK (GET, PUT, DELETE r√©ussis)
- `201` : Created (POST r√©ussi)
- `400` : Bad Request (donn√©es invalides)
- `404` : Not Found (ressource non trouv√©e)
- `409` : Conflict (duplicate, ex: email existant)
- `500` : Internal Server Error (erreur serveur)

---

## üîê S√©curit√© (√† am√©liorer)

### ‚ö†Ô∏è Points critiques √† impl√©menter

1. **Hashing des mots de passe**
   - [ ] Installer `bcrypt`
   - [ ] Hasher les mots de passe avant insertion
   - [ ] Comparer les hash lors du login

2. **Authentification JWT**
   - [ ] Installer `jsonwebtoken`
   - [ ] Cr√©er un endpoint `/auth/login`
   - [ ] G√©n√©rer et v√©rifier les tokens JWT
   - [ ] Middleware d'authentification

3. **Validation des donn√©es**
   - [ ] Installer `express-validator` ou `joi`
   - [ ] Valider tous les inputs
   - [ ] Sanitiser les donn√©es

4. **Rate Limiting**
   - [ ] Installer `express-rate-limit`
   - [ ] Limiter les requ√™tes par IP

5. **HTTPS**
   - [ ] Configurer SSL/TLS en production

---

## üîÑ Relations entre tables

```
users (1) ‚îÄ‚îÄ< user_programs >‚îÄ‚îÄ (N) programs
                                      ‚îÇ
                                      ‚îÇ (1)
                                      ‚îÇ
                                      ‚ñº
                                  sessions (N)
                                      ‚îÇ
                                      ‚îÇ (1)
                                      ‚îÇ
                                      ‚ñº
                              session_exercises (N)
                                      ‚îÇ
                                      ‚îÇ (N)
                                      ‚îÇ
                                      ‚ñº
                                  exercises (1)

users (1) ‚îÄ‚îÄ< user_session_logs >‚îÄ‚îÄ (N) sessions
```

**L√©gende** :
- `(1)` : Relation un
- `(N)` : Relation plusieurs
- `‚îÄ‚îÄ<` : Relation un-√†-plusieurs
- `>‚îÄ‚îÄ<` : Relation plusieurs-√†-plusieurs (table de liaison)

---

## üéØ Roadmap de d√©veloppement

### Phase 1 : Base ‚úÖ TERMIN√â
- [x] Configuration projet (Express, MySQL, dotenv)
- [x] Connexion base de donn√©es
- [x] CRUD Users complet
- [x] Documentation API

### Phase 2 : Programmes d'entra√Ænement üîÑ EN COURS
- [ ] CRUD Programs
- [ ] Relation User-Programs
- [ ] Assignation de programmes aux utilisateurs

### Phase 3 : Sessions et exercices
- [ ] CRUD Sessions
- [ ] CRUD Exercises
- [ ] Relation Sessions-Exercises
- [ ] D√©tails des exercices dans une session

### Phase 4 : Suivi et historique
- [ ] Logs des sessions effectu√©es
- [ ] Statistiques utilisateur
- [ ] Progression dans les programmes

### Phase 5 : S√©curit√©
- [ ] Hashing mots de passe (bcrypt)
- [ ] Authentication JWT
- [ ] Middleware de protection des routes

### Phase 6 : Features avanc√©es
- [ ] Upload d'images/vid√©os (exercices)
- [ ] Recherche et filtres
- [ ] Pagination
- [ ] WebSocket pour notifications temps r√©el

---

## üìù Notes techniques importantes

### Pool de connexions MySQL

Le fichier `db.js` utilise un pool de connexions pour optimiser les performances :
```javascript
connectionLimit: 10  // Max 10 connexions simultan√©es
```

### Variables d'environnement requises

```env
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=followSport_app
DB_PORT=3306
PORT=9001
NODE_ENV=development
```

### D√©marrage du serveur

```bash
# D√©veloppement (avec auto-reload)
npm run dev

# Production
npm start
```

---

## üêõ Debug et troubleshooting

### Erreur de connexion MySQL

```
‚ùå Erreur de connexion MySQL: Access denied
```

**Solution** : V√©rifier les credentials dans `.env`

### Port d√©j√† utilis√©

```
Error: listen EADDRINUSE: address already in use :::9001
```

**Solution** : 
```bash
# Trouver le process
lsof -i :9001

# Tuer le process
kill -9 <PID>

# Ou changer le port dans .env
PORT=9002
```

---

## üìö Ressources utiles

- [Express.js Documentation](https://expressjs.com/)
- [MySQL2 Documentation](https://github.com/sidorares/node-mysql2)
- [Node.js Best Practices](https://github.com/goldbergyoni/nodebestpractices)

---

**Derni√®re mise √† jour** : 17 octobre 2025  
**Maintenu par** : √âquipe FollowSport

